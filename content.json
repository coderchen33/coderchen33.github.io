{"pages":[],"posts":[{"title":"物理层","text":"主要内容 物理层的任务 信道复用技术 宽带接入技术 物理层任务主要任务：确定与传输媒体的接口的一些特性。 机械特性 ：指明接口所用接线器的形状和尺寸、引线数目和排列、固定和锁定装置等。 电气特性：指明在接口电缆的各条线上出现的电压的范围。4V— 6V表示二进制“0”,用-4V—-6V表示二进制“1” 功能特性：指明某条线上出现的某一电平的电压表示何种意义。 过程特性 ：指明对于不同功能的各种可能事件的出现顺序。 信道复用技术 频分复用：所有主机在相同的时间占用不同的频率带宽资源 时分复用：所有主机在不同的时间占用相同的频率带宽资源 统计时分复用：是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成统计时分复用帧然后发送 宽带接入技术 ADSL非对称数字用户线ASDL是用数字技术对模拟电话用户线进行改造。 ADSL把0~4kHZ的低频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用。 由于我们在上网时主要是从互联网上下载各种文档，而向互联网发送的信息量一般都不打。因此ADSL的下行(从ISP到用户)带宽都远大于上行(从用户到ISP)带宽，因此成为非对称的。 ADSL 的特点： 上行和下行带宽做成不对称的。 ADSL 在用户线（铜线）的两端各安装一个 ADSL 调制解调器。 我国目前采用的方案是离散多音调 DMT，DMT 调制技术采用频分复用的方法 ADSL 采用自适应调制技术使用户线能够传送尽可能高的数据率 光纤同轴混合网（HFC网）在有线电视网的基础上开发的一种居民宽带接入网。 用户接口盒 UIB (User Interface Box) 要提供三种连接，即： 使用同轴电缆连接到机顶盒 (set-top box)，然后再连接到用户的电视机。 使用双绞线连接到用户的电话机。 使用电缆调制解调器连接到用户的计算机。 FTTx FTTx 表示 Fiber To The…（光纤到…），例如： 光纤到户 FTTH (Fiber To The Home)：光纤一直铺设到用户家庭，可能是居民接入网最后的解决方法。 光纤到大楼 FTTB (Fiber To The Building)：光纤进入大楼后就转换为电信号，然后用电缆或双绞线分配到各用户。 光纤到路边 FTTC (Fiber To The Curb)：光纤铺到路边，从路边到各用户可使用星形结构双绞线作为传输媒体。","link":"/2020/03/07/%E2%80%9C%E7%89%A9%E7%90%86%E5%B1%82/"},{"title":"计算机网络开篇","text":"计算机网络 搞起来 哇咔咔 互联网、因特网与万维网 互联网的组成 计算机网络类别 计算机网络的性能 计算机网络体系结构 互联网、因特网与万维网 互联网：网络把主机连接起来，而互联网是通过某种协议将多种不同的网络连接起来， 因此互联网是网络的网络。 国际标准的互联网写法是internet，字母i小写！ 因特网：采用TCP/IP协议族作为通信的规则的互联网。国际标准的因特网写法是Internet，字母I大写！ TCP/IP协议由很多协议组成，不同类型的协议又被放在不同的层，其中，位于应用层的协议就有很多，比如FTP、SMTP、HTTP。所以，因特网提供的服务一般包括有：www（万维网）服务、电子邮件服务（outlook）、远程登录（QQ）服务、文件传输（FTP）服务、网络电话等等 万维网(www)：只要应用层使用的是HTTP协议，就称为万维网。万维网又称环球网，是一种建立在Internet上的全球性的、交互的、动态、多平台、分布式、图形信息系统。它只是建立在Internet上的一种网络服务。 之所以在浏览器里输入百度网址时，能看见百度网提供的网页，就是因为你的个人浏览器和百度网的服务器之间使用的是HTTP协议在交流。 三者关系：互联网包含因特网，因特网包含万维网 目前，围绕互联网发展的业务主要有两类，分别是ISP（因特网服务提供商）与ICP（因特网网内容提供商） ISP(Internet Service Provider):指向广大用户综合提供互联网接入业务、信息业务和增值业务的电信运营商（比如中国电信、移动、联通提供的宽度服务）ISP拥有从因特网管理机构申请到的多个IP地址，同时拥有通信线路以及路由器等连网设备。中国的电信、网通等都是ISP，我们通常所说的上网就是指通过某个ISP接入到因特网，IP地址的管理机构不会把一个单个的IP地址分配给单个用户，而是把一批IP地址有偿地分配给经审查合格的ISP。现在的因特网是由全世界无数个大大小小的ISP所共同拥有的。 ICP(Internet Content Provider):向广大用户综合提供互联网信息和增值业务的企业（比如：新浪、搜狐、腾讯）。其实，我们说的ICP域名备案就是指互联网内容提供商向工信部提交经营审核。 互联网的组成因特网的拓扑结构虽然非常复杂，并且在地理上覆盖全球，单从工作方式上看，可以划分为以下两大块： 网络边缘：由所连接在因特网上的主机组成。这部分是用户直接使用的，用来进行通信和资源共享。主机也称为端系统 网络核心：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的 在互联网边缘的端系统之间的通信方式通常可划分为两类： 客户服务器方式（Client/Server, C/S方式）：客户和服务器都是指通信中所涉及到的两个应用进程。最主要的特征是：客户是服务请求方，服务器是服务提供方C/S方式是因特网上最常用的传统方式，我们在网上发送电子邮件或在网站上查找资料时，都是客户服务器方式。 对等方式（Peer-to-Peer, P2P方式）：两个主机在通信时并不区分哪一个是服务请求者还是服务提供者，这要两个主机都运行了对等连接软件，他们就可以进行平等的、对等连接通信。这时，双方都可以下载对方已经存储在硬盘中的共享文档，因此这种工作方式也称为P2P文件共享。 还有一种被称为浏览器服务器的方式（B/S, Browser/Server方式），可以看作是客户服务器方式的特例。只不过客户端是浏览器而已。 互联网核心部分 电路交换 ：电路交换用于电话通信系统，两个用户要通信之前需要建立一条专用的物理链路，并且在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到 10%。 分组交换 ：分组交换采用存储转发技术。每个分组都有首部和尾部，包含了源地址和目的地址等控制信息，在同一个传输线路上同时传输多个分组互相不会影响，因此在同一条传输线路上允许同时传输多个分组，也就是说分组交换不需要占用传输线路。 计算机网络类别按照网络的作用范围进行分类 广域网WAN:通过长距离(例如跨越不同国家)运送主机发送数据。 作用范围通常为几十到几千公里 城域网MAN: 一般是一个城市。 作用距离为5~50km 局域网LAN: 用计算机或工作站通过高速通信线路相连。作用距离为1km左右。学校或企业大都拥有多个互连的局域网称为校园网或企业网。 个人局域网PAN:把属于个人的电子设备用无线技术连接起来的网络，也常称为无线个人局域网(WPAN)。 作用距离10m左右。 按照网络的使用者进行分类 公用网： 指电信公司出资建造的大型网络。需要向电信公司交纳一定的费用 专用网： 指某个部门因为特殊业务工作需要而建造的网络。不向本单位以外的人提供服务。如军队、铁路、银行、电力系统等。 用来把用户接入到互联网的网络 接入网AN： 搭建起用户与互联网连接的”桥梁”。 计算机网络的性能 比特率：连接在计算机网络上的主机在数字信道上传送数据的速率。比特率速率的单位是b/s（比特每秒），有时候也写为bps，即bit persecond 带宽：表示在单位时间内从网络的某一点到另一点所能通过的最高数据率,单位是bit/s。 吞吐量：在单位时间内通过某个网络的实际数据量。是表示实际网络传输是的速率。 受网络带宽或网络的额定速率的限制。 时延：数据从网络一端传送到另一端所需要的时间。(1) 发送时延： 主机或路由器发送数据帧所需要的时间(2) 排队时延： 分组经过路由器后，要先在输入队列中排队等待处理(3) 处理时延： 主机或路由器收到分组时需要花费一定时间进行处理，如分析首部、提取数据部分、差错检测等。(4) 传播时延： 电磁波在信道中传播一定距离花费的时间。约为光速。 总时延 = 发送时延 + 排队时延 + 处理时 + 延传播时延 另外，在描述数据量大小时，往往使用字节（byte）作为度量单位。一个字节（记为大写的B）代表8个bit即1byte = 8bit在实际上网应用中，下载软件时常常看到诸如下载速度显示为176KB/s，103KB/s等宽带速率大小字样，因为ISP提供的线路带宽使用的单位是比特（bit），而一般下载软件显示的是字节（Byte）（1Byte=8bit），所以要通过换算，才能得实际值。我们以1M宽带为例，按照换算公式换算一下：1Mb/s=1024*1024b/s=1024K b/s=1024/8KB/s=128KB/s 计算机网络体系结构 OSI模型是国际标准组织提出过一个标准框架，只要遵循OSI标准，一个系统就可以和世界上任何地方的、也遵循统一标准的其他任何系统进行通信。但它既复杂又不实用。TCP/IP是一个四层的体系结构，包含应用层、传输层、网际层和网际接口层。不过从实质上讲，TCP/IP只有最上面的三层，网际接口层并没有什么具体内容。因此学习计算机网络的原理时往往采取折中的办法，即总和OSI和TCP/IP的优点，采用一种五层协议的体系结构。 下面看一下每层的具体作用： 应用层 ：为特定应用程序提供数据传输服务，例如 HTTP、DNS 等协议。数据单位为报文。 传输层 ：为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。传输层包括两种协议： 传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。 TCP 主要提供完整性服务，UDP 主要提供及时性服务。 网络层 ：为主机提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务。网络层把传输层传递下来的报文段或者用户数据报封装成分组。 数据链路层 ：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为同一链路的主机提供数据传输服务。数据链路层把网络层传下来的分组封装成帧。 物理层 ：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。 OSI中的剩余两层： 表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。 会话层 ：建立及管理会话。五层协议没有表示层和会话层，而是将这些功能留给应用程序开发者处理。 数据传输过程： 在向下的过程中，需要添加下层协议所需要的首部或者尾部，而在向上的过程中不断拆开首部和尾部。","link":"/2020/03/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%BC%80%E7%AF%87/"},{"title":"数据链路层","text":"主要内容 数据链路层的三个基本问题：封装成帧、透明传输、差错检测 点对点信道PPP协议 和 广播信道CSMA/CD协议 局域网、以太网、MAC地址和适配器 集线器、网桥、交换机 虚拟局域网(VLAN) 以太网网络接入PPPoE协议 链路层提供的服务1.封装成帧所有在因特网上传送的数据都是以IP数据报为传送单位的，网络层的IP数据报传送到数据链路层就成为帧的数据部分，在帧的数据部分的前面和后面添加上首部和尾部，构成一个完整的帧。 图为RFC 1042和以太网的封装格式其中CRC字段用于帧内后续字节差错的循环冗余码检验 最大传送单元(MTU)(Maximum Transfer Unit)：每一种链路层协议都规定了帧的数据部分的长度上限。比如上图中以太网数据帧的长度最大值分别是1500字节。 路径MTU:如果两台主机之间的通信要通过多个网络，那么每个网络的链路层就可能有不同的MTU。重要的不是两台主机所在网络的MTU的值，重要的是两台通信主机路径中的最小MTU。它被称作路径MTU。注意：从A到B的路由可能与从B到A的路由不同，因此路径MTU在两个方向上不一定是一致的 2.透明传输透明传输，即无论什么样的比特流都能够通过数据链路层传输。 帧使用首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，那么帧的开始和结束位置就会被错误的判定。 解决这种矛盾的方法是，将数据中可能出现的控制字符的前面插入转义字符“ESC”，而在接收端再删除该转义字符，这种方法被称为字节填充。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。 3.差错检测现实的通信线路都不会是理想的，比特在传输过程中可能会产生差错：1可能会变成0，0也可能会变成1。为了保证数据传输的可靠性，必须采用各种差错检测措施。目前在数据链路层广泛使用的是循环冗余检验CRC（Cyclic Redundancy Check） 我们并没有要求数据链路层向网络层提供“可靠传输”服务，是因为：“可靠传输”指的是数据链路层发送端发送什么，在接收端就收到什么。而传输差错除了上面提到的比特差错外，还会有一些其他差错。如帧丢失、帧重复或帧失序。 信道分类点对点信道一对一通信因为不会发生碰撞，因此也比较简单，使用 PPP(Point-to-PointProtocol)协议进行控制。 PPP协议我们知道，因特网用户通常都要连接到某个ISP才能接入到因特网。PPP协议就是用户计算机和ISP进行通信时所使用的数据链路层协议。 PPP协议由三个部分组成：（1）一个将IP数据报封装到串行链路的方法。（2）一个用来建立、配置和测试数据链路连接的链路控制协议LCP（Link Control Protocol）。（3）一套网络控制协议NCP（Network Control Protocol）。 当用户拨号接入ISP后，就建立了一条从用户PC机到ISP的物理连接。这时，用户PC机向ISP发送一系列的LCP分组（封装成多个PPP帧），以便建立LCP连接。这些分组及其响应选择了将要使用的一些PPP参数。接着还要进行网络层配置，NCP给新接入的用户PC机分配一个临时的IP地址。这样，用户PC机就成为一个拥有IP地址的主机了。 当用户通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。接着，LCP释放数据链路层连接。最后释放的是物理层的连接。 PPP帧结构 F 字段为帧的定界符 A 和 C 字段暂时没有意义 FCS 字段是使用 CRC 的检验序列 信息部分的长度不超过 1500 广播信道一对多通信 一个节点发送的数据能够被广播信道上所有的节点接收到。局域网就是一个很好的例子 由于所有的节点都在同一个广播信道上发送数据，因此需要有专门的控制方法进行协调，避免发生冲突（冲突也叫碰撞）。 主要有两种控制方法进行协调，一个是使用信道复用技术(代价较高，不适用于局域网)，一是使用 CSMA/CD（载波监听多点接入/碰撞检测）协议。 CSMA/CD协议CSMA/CD 表示载波监听多点接入 / 碰撞检测。 多点接入 ：说明这是总线型网络，许多主机以多点的方式连接到总线上。 载波监听 ：不管在发送前还是在发送中，每个主机都必须不停地监听信道。在发送前，如果监听到信道正在使用，就必须等待。 碰撞检测 ：在发送中，如果监听到信道已有其它主机正在发送数据，就表示发生了碰撞。虽然每个主机在发送数据之前都已经监听到信道为空闲，但是由于电磁波的传播时延的存在，还是有可能会发生碰撞。 记端到端的传播时延为 τ，最先发送的站点最多经过 2τ 就可以知道是否发生了碰撞，称2τ为争用期 。只有经过争用期之后还没有检测到碰撞，才能肯定这次发送不会发生碰撞。 当发生碰撞时，站点要停止发送，等待一段时间再发送。这个时间采用截断二进制指数退避算法来确定。从离散的整数集合 {0, 1, .., (2k-1)} 中随机取出一个数，记作 r，然后取r倍的争用期作为重传等待时间。 局域网局域网主要特点是网络为一个单位所拥有，且地理范围和站点数目均有限。 局域网具有广播功能，从一个站点可很方便地访问全网，局域网上的主机可共享连接在局域网上的各种硬件和软件资源。 局域网主要有以太网、令牌环网、FDDI 和 ATM 等局域网技术，目前以太网占领着有线局域网市场。 按照网络拓扑结构对局域网进行分类: 以太网由于以太网技术的快速发展，目前在局域网市场中占据了绝对优势，现在以太网几乎成为了局域网的同义词。 传统以太网是总线型网络结构，但随着集线器和双绞线的出现，以太网主要是星型网络拓扑结构。从表面上看，使用集线器的局域网在物理上是一个星型网，但由于集线器使用电子器件模拟实际电缆线工作，因此在逻辑上仍然是一个总线网，使用的还是CSMA/CD协议。 MAC地址MAC 地址是链路层地址，长度为 6 字节（48位），用于唯一标识网络适配器（网卡）。 一台主机拥有多少个网络适配器就有多少个 MAC 地址。例如笔记本电脑普遍存在无线网络适配器和有线网络适配器，因此就有两个 MAC 地址。 MAC帧格式： 如上图所示，MAC地址由五个字段组成。前两个字段为目的地址和源地址。第三个字段是类型字段，用来标识上一层使用的是什么协议，以便把收到的MAC帧的数据上交给上一层的这个协议。第四个字段是数据字段，最后一个是帧检验序列FCS（使用CRC检验）。 适配器计算机与外界局域网的连接是通过适配器。 计算机的硬件地址就在适配器的ROM中，而计算机的IP地址则在计算机的存储器中。 适配器有帧过滤功能。适配器从网络上每收到一个MAC帧就先用硬件检查MAC帧中的目的地址，如果是发往本站的帧则收下，否则丢弃。发往本站的帧包括以下三种帧： 单播帧，即收到的帧的MAC地址与本站的硬件地址相同。 广播帧，即发送给本局域网上所有站点的帧。（全1） 多播帧，即发送给本局域网上一部分站点的帧。 局域网的扩展在物理层扩展局域网集线器 采用双绞线的以太网采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫做集线器(hub) 集线器使用电子器件模拟实际电缆线工作，因此在逻辑上仍然是一个总线网 由于是总线网结构,因此集线器使用的还是CSMA/CD协议。所以同一个时间只能有两个端口是互联的，其它的端口都处于载波侦听状态，无法使用网络带宽。 集线器工作在物理层， 作用于比特而不是帧.当一个比特到达接口时，集线器重新生成这个比特，并将其能量强度放大，从而扩大网络的传输距离，之后再将这个比特发送到其它所有接口。如果集线器同时收到两个不同接口的帧，那么就发生了碰撞。 优点： 使原来属于不同碰撞域的局域网上的计算机能够进行跨碰撞域的通信。 扩大了局域网覆盖的地理范围。 缺点 碰撞域增大了，但总的吞吐量并未提高。 如果不同的碰撞域使用不同的数据率，那么就不能用集线器将它们互连起来。 在数据链路层扩展局域网网桥 工作在数据链路层。具有过滤帧的功能,当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口。 优点 过滤通信量。 扩大了物理范围。 提高了可靠性。 可互连不同物理层、不同 MAC 子层和不同速率（如10Mb/s 和 100 Mb/s 以太网）的局域网 缺点 存储转发增加了时延。 在MAC子层并没有流量控制功能。 具有不同 MAC子层的网段桥接在一起时时延更大。 网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴。 交换机 交换式集线器淘汰了网桥，并且由于性能远超普通集线器，淘汰了在物理层的集线器。目前以太网主要使用交换机 交换机工作在数据链路层，（又称以太网交换机、交换式集线器)。交换机实质上就是一个多接口的网桥。它不会发生碰撞，能根据 MAC 地址进行存储转发。 以太网交换机工作在全双工方式。区别于传统的使用集线器的总线以太网使用CSMA/CD协议，以半双工的方式工作，以太网交换机一般工作在全双工方式，不适用CSMA/CD协议 以太网交换机具有并行性 即能同时连通多对接口，使多对主机能同时通信。所以相互通信的主机都是独占传输媒体，无碰撞地传输数据。比如对于普通 10 Mb/s 的共享式以太网，若共有 N个用户，则每个用户占有的平均带宽只有总带宽(10 Mb/s)的 N 分之一。使用以太网交换机时，虽然在每个接口到主机的带宽还是 10 Mb/s，但由于一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因此对于拥有 N 对接口的交换机的总容量为 N*10 Mb/s。这正是交换机的最大优点。 以太网交换机是即插即用的 以太网交换机内部的帧交换表（又称为地址表）是通过自学习算法自动地逐渐建立起来的。 虚拟局域网虚拟局域网（Virtual Local Area Network，VLAN）是一组逻辑上的设备和用户，通过端口分配、MAC地址分配等方式将同一局域网内的主机划分为不同的区域（VLAN），不同区域之间的主机无法直接通信（即使它们都在同一个有线局域网中），而同一区域内的主机之间可以正常通信，这就好像一个局域网一样，因此叫做虚拟局域网。 与传统局域网相比优点： 网络设备的移动、添加和修改的管理开销减少 可以控制广播活动 可以提高网络的安全性 完全隔离的两个VLAN如何通信？使用VLAN干线连接来建立虚拟局域网，每台交换机上的一个特殊接口被设置为干线接口，以互连VLAN交换机。该干线端口属于所有VLAN，发送到任何VLAN的帧经过干线链路转发到其他交换机。 交换机如何区别到达干线端口的帧属于哪个VLAN？IEEE 定义了一种扩展的以太网帧格式 802.1Q，它在标准以太网帧上加进了4字节首部VLAN标签，用于表示该帧属于哪一个虚拟局域网。 使用以太网进行网络接入以太网接入的一个重要特点是它可以提供双向的带宽通信，并且可以根据用户对带宽的需求灵活的进行带宽升级。 然而以太网帧格式标准中，在地址字段部分并没有用户名字段，也没有让用户键入密码来鉴别用户身份过程，于是人们想到将PPP协议再封装到以太网中来传输，就是1999年公布的PPPoE协议。因此，PPPoE协议是宽带上网的主机使用的链路层协议。","link":"/2020/03/07/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/"},{"title":"网络层(一)","text":"主要内容 虚拟互联网络的概念 IP地址和物理地址的关系 传统的分类的IP地址（子网掩码）和无分类域间路由选择CIDR 网络层服务及虚拟互联网的概念因为网络层是整个互联网的核心，因此应当让网络层尽可能简单。 网络层向上只提供简单的、无连接的、尽最大努力交互(不可靠)的数据报服务。 无连接：IP并不需要事先建立连接或者维护任何关于后续数据报的状态信息。每个数据报的处理相互独立，并且可以不按发送顺序接收。 不可靠：它不能保证IP数据报能成功地到达目的地。IP仅提供最好的传输服务 所传送的分组可能出错、丢失、重复和失序，当然也不保证分组交付的时限。 使用 IP 协议，可以把异构的物理网络连接起来，使得在网络层看起来好像是一个统一的网络称为虚拟互联网络，由于使用的是IP协议也称为IP网。 与IP协议配套使用的还有三个协议： 地址解析协议 ARP (Address Resolution Protocol) 网际控制报文协议 ICMP (Internet Control Message Protocol) 网际组管理协议 IGMP (Internet Group Management Protocol) 逆地址解析协议(RARP) (DHCP协议(应用层协议)已经包含了RARP协议，所以RARP协议现在已经不使用了) IP地址和物理地址物理地址是数据链路层和物理层使用的地址，而IP地址（32位）是网络层和以上各层使用的地址，是一种逻辑地址。 下图为3个局域网用2个路由器R1和R2连接起来，现在主机H1要和主机H2进行通信。 通信路径为 H1-&gt;经过R1转发-&gt;经过R2转发-&gt;H2 其中路由器R1和R2同时连接在两个局域网上，因此有两个硬件地址 实际在不同层次中的不同区间的源地址和目的地址 我们可以知道： 在IP层抽象的互联网上只能看到IP数据报 路由器只根据目的IP地址进行路由选择 在局域网链路层只能看见MAC地址。 (从表中可以看到在从H1到H2通信过程中MAC帧首部的源地址和目的地址发生变化，在上面的IP层看不见这种变化) IP层抽象的互联网屏蔽了下层复杂细节，只要我们在网络层上讨论问题，就能够使用统一的、抽象的IP地址研究主机和主机或路由器之间的通信。 ARP协议网络层使用的是IP地址，最终在实际网络的链路上传送数据帧时，最终还是必须使用硬件地址。这就需要解决一个问题，如何根据一个机器的IP地址找出其对应的物理地址 地址解析协议ARP就是根据IP地址找出其对应的物理地址。 ARP工作过程： 当主机A要向本局域网上的某台主机B发送IP数据报，就先在其ARP高速缓存中查看有无主机B的IP地址。 如果ARP高速缓存中有该IP地址到MAC地址的映射，就在ARP高速缓存中查出其对应的硬件地址，再把硬件地址写入MAC帧中，然后通过局域网把该MAC地址发往此硬件地址。 如果没有，此时主机A就自动运行ARP。首先通过广播的方式发ARP请求分组，主机B收到该请求后会发送ARP响应分组给主机A告知其MAC地址。 主机A收到主机B的ARP响应分组后，向其高速缓存中写入主机B的IP地址到 MAC 地址的映射。 ARP协议抓包分析 ARP协议注意: ARP协议只在局域网中工作,如果要找的主机和源主机不在同一个局域网上(如上面的H1和H2)，H1就无法解析出另一个局域网H2主机。而是把路由器R1的IP地址解析为硬件地址HA3,以便能把IP数据报传送到路由器R1。 之后再由R1进行分组转发，直至最终交付给主机H2。 每个主机都有一个ARP高速缓存，里面有本局域网上的各主机和路由器的IP地址到MAC地址的映射表，并且这个映射表还可以动态更新。 IP地址划分IP地址就是给互联网上的每一台主机(或路由器)的每一个接口分配一个在全世界范围内唯一的32位的标识符。对IP地址的编址方式经历了三个历史阶段： 分类的IP地址 （最基本编址方法） 子网的划分 （对最基本编址方法的改进） 构成超网 （无分类编址，1993年提出后很快得到推广应用） 分类的IP地址由两部分组成，网络号和主机号。IP 地址 ::= {&lt; 网络号 &gt;, &lt; 主机号 &gt;} 这些32位的地址通常写成四个十进制的数，其中每个整数对应一个字节。这种表示方法称作“点分十进制表示法（Dotted decimal notation）”区分各类地址的最简单方法是看它的第一个十进制整数，如下图所示。 常用IP 子网的划分由三部分组成，网络号、子网号和主机号。IP地址 ::= {&lt;网络号&gt;, &lt;子网号&gt;, &lt;主机号&gt;} 为什么需要划分子网呢，因为上面的两级IP地址虽然方便，但却有很多缺点： IP地址空间的利用率有时很低 给每一个物理网络分配一个网络号会使路由表变得太大而使网络性能变坏 两级IP地址不够灵活 所以为了解决上面的问题，所以在分类IP地址中增加了一个子网字段，使得两级IP地址变为三级IP地址。这种方法叫做划分子网 划分子网的注意: 划分子网纯属一个单位内部的事情。单位对外仍然表现为一个网络。 划分子网的方法是从主机号借用若干个位作为子网号subnet-id，而主机号host-id也就相应减少了若干个位。 凡是从其他网络发送给本单位某个主机的IP数据报，仍然是根据 IP 数据报的目的网络号 net-id，先找到连接在本单位网络上的路由器。然后此路由器在收到 IP 数据报后，再按目的网络号 net-id 和子网号 subnet-id 找到目的子网(需要借助于子网掩码)。最后就将 IP 数据报直接交付目的主机。 无分类编址CIDR（构造超网）由网络前缀号和主机号组成。IP地址::= {&lt; 网络前缀号 &gt;, &lt; 主机号 &gt;} 无分类编址CIDR消除了传统 A类、B类和C类地址以及划分子网的概念，并且网络前缀的长度可以根据需要变化。 CIDR的记法上采用在IP地址后面加上网络前缀长度的方法，例如 128.14.35.7/20表示前20位为网络前缀。 CIDR的地址掩码可以继续称为子网掩码，子网掩码1的长度为网络前缀的长度。 一个组织通常被分配成一块连续的地址，即具有相同前缀的一段地址，这种情况下，该组织内部的设备的IP地址将共享共同的前缀。剩余的32-x比特用于区分该组织内部设备。 一个 CIDR地址块中有很多地址，一个CIDR表示的网络就可以表示原来的很多个网络，并且在路由表中只需要一个路由就可以代替原来的多个路由，减少了路由表项的数量。把这种通过使用网络前缀来减少路由表项的方式称为路由聚合，也称为构成超网。 子网掩码上面使用子网的IP地址和无分类编址CIDR都提到了子网掩码，什么是子网掩码呢？它的作用是什么呢？我们举个例子就可以理解了 下图表示某单位拥有一个B类IP地址，网络地址是145.13.0.0（网络号是145.13） 现把上图中的网络划分为三个子网，这里假定子网号占用8位，因此主机号只剩8位。所划分的子网分别是：145.13.3.0 145.13.7.0、145.13.21.0 划分子网后，整个网络对外仍表现为一个网络，其网络地址仍为145.13.0.0，但是路由器R1在收到外来的数据报后，再根据数据报的目的地址把它转发到相应的子网。 假定有一个数据报的目的地址是145.13.3.10已经到达路由器R1，那么这个路由器如何把它转发到子网145.13.3.0呢？这就需要借助子网掩码（subnetmask）来实现了。 路由器会把子网掩码和收到的数据报地址的目的IP地址145.13.3.10进行按位“与”操作，得出所要找的子网的网络地址 可以看到，子网掩码与IP地址进行“与”操作之后，就将主机号“过滤”掉了，只剩下了网络号与子网号。 实际上，因特网的标准规定：所有网络必须使用子网掩码。即便一个网络没有划分子网，也要使用默认子网掩码。默认子网掩码中1的位置和IP地址中的网络号字段正好相对应，因此，两者进行“与”操作后，就能得出该IP地址的网络地址。 A类、B类、C类地址的默认子网掩码是固定的： 例，已知 IP 地址是141.14.72.24（注意是IP数据报中的目的地址），子网掩码是 255.255.192.0。试求子网网络地址。","link":"/2020/03/07/%E7%BD%91%E7%BB%9C%E5%B1%82/"},{"title":"网络层(二)","text":"主要内容 IP数据报格式 IP层分组转发算法 路由选择协议 ICMP协议、ping、traceroute 路由器的功能就是进行分组转发和路由选择，路由器是如何在知道IP地址时进行分组转发或者路由选择呢？ 为此，我们需要先了解下IP数据报的格式。 IP数据报的格式 版本 : 有 4（IPv4）和 6（IPv6）两个值； 首部长度 : 占4位，因此最大值为15。值为1表示的是1个32位字的长度，也就是4字节（即单位是4个字节，最多表示60个字节）。因为IP首部固定部分长度为20字节，因此该值最小为5。如果可选字段的长度不是4字节的整数倍，就用尾部的填充部分来填充。最常用的首部长度是20字节，这时不适用任何选项。 区分服务 : 占8位，用来获得更好的服务，一般情况下不使用。 总长度 : 包括首部长度和数据部分长度。单位为字节。因此数据报最大长度为2^16-1=65535字节。但我们知道数据链路层中规定了数据帧中的数据字段的最大长度即最大传送单元MTU（通常为1500字节）。当数据报总长度超过MTU时，就必须把过长的数据报进行分片处理。在进行分片时，数据报首部中的总长度字段指分片后的每一个分片的首部长度与该分片的数据长度的总和。 标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。 标志 ： 占3位，但目前只有两位有意义。其中最低位记为MF。MF=1即表示后面还有分片的数据报，MF=0表示这是若干数据报中的最后一个。中间位记为DF，意思是不能分片，只有当DF=0时才允许分片。 片偏移 : 和标识符一起，用于发生分片的情况。表明较长的分组在分片后，某片在原分组中的相对位置，也就是说相对于用户数据字段的起点。片偏移的单位为8字节。 生存时间 ：TTL，它的存在是为了防止无法交付的数据报在互联网中不断兜圈子。以路由器跳数为单位，当 TTL为0时就丢弃数据报。 协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。 首部检验和 ：因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。 源地址：32位 目的地址：32位 分片： 分组转发算法使用分类IP的分组转发算使用分类的IP地址的转发，可以看到路由表中主要是以下两个信息： （目的网络地址， 下一跳地址） 以路由器R2的路由表为例，由于R2同时连接在网络2和3上，因此只要目的主机在网络2或3上，都可以通过接口0或1有路由器R2直接进行交付（当然还要利用地址解析协议ARP才能找到这些主机的硬件地址）。若目的主机在网络1中，则下一跳路由应为R1，其IP地址为20.0.0.7。路由器R1和R2由于同时连接在网络2上，因此从路由器R2把分组转发给路由器R1是很容易的。 使用分类IP的分组转发算法过程 从数据报的首部提取目的主机的 IP 地址 D, 得出目的网络地址为 N。 若网络 N 与此路由器直接相连，则把数据报直接交付目的主机 D；否则是间接交付，执行步骤3。 若路由表中有目的地址为 D 的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行步骤4。 若路由表中有到达网络 N 的路由，则把数据报传送给路由表指明的下一跳路由器；否则，执行步骤5。 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行步骤6。 报告转发分组出错。 上面步骤5中提到的默认路由对于连接在小网络上的主机发送IP数据报时是十分有用的。如下图中连接在网络N1上的任何一个主机中的路由表只需要三个项目即可。 本网络主机路由，其目的网络就是本网络N1,因而不需要路由转发。 到网络N2的路由，对应的下一条路由器是R2 默认路由，只要目的网络是其他网络(不是N1或N2),就一律选择默认路由，把数据报先交付路由器R1,让R1再转发给互联网中的下一个路由，一直转发到目的网络上的路由器，最后进行直接交付。 使用子网的分组转发算法在划分子网的情况下，分组转发算法必须做相应改动，路由表中必须包含以下三项内容:目的网络地址、子网掩码、下一跳地址 使用子网的分组转发算法 从收到的数据报的首部提取目的IP地址D。 先判断是否为直接交付。对路由器直接相连的网络逐个进行检查：用各网络的子网掩码和D逐位“与”，看结果是否和相应的网络地址匹配，若匹配，则把分组进行直接交付（当然还需要把D转换成物理地址，把数据报封装成帧发送出去），转发任务结束。否则是间接交付，执行步骤3。 若路由表中有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由。否则执行步骤4 对路由表中的每一行（目的网络地址、子网掩码、下一跳地址），用其中的子网掩码和D逐位相“与”，其结果为N。若N与该行的目的网络地址匹配，则把数据报传动给该行指明的下一跳路由。否则执行步骤5. 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行步骤6。 报告转发分组出错。 比如对于上面的图中H1与主机H2之间进行通信，首先H1会将H2的IP地址128.30.33.128和本子网的网络地址128.30.33.0相与，得到128.30.33.0，与自己本子网的网络地址不同，则判断为间接交付，将数据报交付给路由器R1，由R1进行转发。 路由器收到数据报后，根据路由表中的记录，将IP地址与子网掩码进行逐位相与，如先看R1路由表的第一行。将子网掩码和目的IP逐位相与后得到128.30.33.128，与这一行的目的网路地址128.30.33.0比较不匹配。 则继续寻找下一行。 可以看到在第二行中匹配成功，则不再继续找下去而是R1把分组从接口1直接交付主机H2。 使用CIDR的分组转发算法在使用CIDR时，由于采用了网络前缀的这种方法，因此在路由表中的项目也要有相应改变。这时，每个项目由两个内容构成：网络前缀、下一跳地址 但是在查找时可能会得到不止一个匹配结果，此时应当采用最长前缀匹配来确定应该匹配哪一个。这是因为网络前缀越长，其地址块越小，因而路由选择就越具体。 具体转发流程和使用子网的分组转发方法类似，只不过中间是用掩码相与后，再使用最长前缀匹配进行选择，不在赘述。 比如，大学下属四系希望ISP把转发给四系的数据报直接发送到四系而不经过大学路由器，则在ISP路由器的路由表中至少有以下两个项目，即206.0.68.0/22(大学) 和206.0.71.128/25。假定目的IP地址为D=206.0.171.130,则按照下图进行掩码逐位与后都匹配，根据最长匹配前缀原理，应当选择后者。 注意： CIDR使用32位的地址掩码，其中1的长度为网络前缀的长度，例如/20的地址掩码为11111111 11111111 11110000 0000。 虽然CIDR不使用子网了，但是仍然可将地址掩码称为子网掩码。注意这个不使用子网的意思是说没有在32位地址中指明若干位作为子网字段，但分配到一个CIDR地址块后，仍然可以在本单位继续划分子网。 并且这些子网的网络前缀比整个单位网路的网络前缀长。 由于CIDR使用的是地址块，因此在路由表中可以直接利用CIDR地址块来查找目的网络，使得路由表中的一个项目可以表示原来传统分类地址的多个路由。这种路由聚合也称为构成超网 路由选择协议路由选择协议就是用来解决路由器中的路由表是如何获得的。 互联网采用的路由选择协议主要是自适应的(即动态的)，分布式路由选择协议。 互联网可以划分为许多较小的自治系统 AS，一个 AS 可以使用一种和别的 AS 不同的路由选择协议。在目前的互联网中，一个大的ISP就是一个自治系统。这样互联网就把路由选择协议划分为两大类： -内部网关协议IGP ： 即在一个自治系统内部使用的路由选择协议。主要有RIP 和 OSPF协议-外部网关协议EGP： 若源主机和目的主机处在不同的自治系统中，当数据报传送到一个自治系统边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议。主要有BGP协议。 内部网关协议 内部网关协议RIP RIP 是一种基于距离向量的路由选择协议。距离是指跳数，直接相连的路由器跳数为 1。跳数最多为 15，超过 15 表示不可达。 RIP 按固定的时间间隔仅和相邻路由器交换自己的路由表，经过若干次交换之后，所有路由器最终会知道到达本自治系统中任何一个网络的最短距离和下一跳路由器地址。 距离向量算法： 对地址为 X 的相邻路由器发来的 RIP 报文，先修改报文中的所有项目，把下一跳字段中的地址改为 X，并把所有的距离字段加 1； 对修改后的 RIP 报文中的每一个项目，进行以下步骤： 若原来的路由表中没有目的网络 N，则把该项目添加到路由表中； 否则：若下一跳路由器地址是 X，则把收到的项目替换原来路由表中的项目；否则：若收到的项目中的距离 d 小于路由表中的距离，则进行更新（例如原始路由表项为 Net2, 5, P，新表项为 Net2, 4, X，则更新）；否则什么也不做。 若 3 分钟还没有收到相邻路由器的更新路由表，则把该相邻路由器标为不可达，即把距离置为 16。 RIP 协议实现简单，开销小。但是 RIP 能使用的最大距离为 15，限制了网络的规模。并且当网络出现故障时，要经过比较长的时间才能将此消息传送到所有路由器。 内部网关协议 OSPF 开放最短路径优先 OSPF，是为了克服 RIP 的缺点而开发出来的。 开放表示 OSPF 不受某一家厂商控制，而是公开发表的；最短路径优先表示使用了 Dijkstra 提出的最短路径算法 SPF。 OSPF 具有以下特点： 向本自治系统中的所有路由器发送信息，这种方法是洪泛法。 发送的信息就是与相邻路由器的链路状态，链路状态包括与哪些路由器相连以及链路的度量，度量用费用、距离、时延、带宽等来表示。 只有当链路状态发生变化时，路由器才会发送信息。 所有路由器都具有全网的拓扑结构图，并且是一致的。相比于 RIP，OSPF 的更新过程收敛的很快。 外部网关协议 BGPBGP（Border Gateway Protocol，边界网关协议） AS 之间的路由选择很困难，主要是由于： 互联网规模很大； 各个 AS 内部使用不同的路由选择协议，无法准确定义路径的度量； AS 之间的路由选择必须考虑有关的策略，比如有些 AS 不愿意让其它 AS 经过。 BGP 只能寻找一条比较好的路由，而不是最佳路由。 每个 AS 都必须配置 BGP 发言人，通过在两个相邻 BGP 发言人之间建立 TCP 连接来交换路由信息。 网际控制报文协议ICMPICMP协议是为了能够更有效地转发IP数据报和提高交付成功的机会。但ICMP不是高层协议(虽然ICMP数据报文作为IP层数据)，而是IP层协议。 ICMP报文： ICMP报文种类有两种： ICMP差错报告报文 ICMP询问报文 常见ICMP报文类型 ICMP差错报告报文具有相同的格式： 其中取需要进行差错报告的IP数据报数据字段前8个字节是为了得到运输层端口号(对于TCP和UDP)以及运输层报文的发送序号(对于TCP)。 ICMP常见的应用就是ping和traceroute ping ping是分组网间嗅探，用来测试两台主机的连通性。 ping是应用层直接使用网络层，没有经过传输层的TCP或UDP ping百度的抓包分析： 可以看到执行ping命令后，直接进行了4次request和reply。在下面的请求报文中可以看到和上面的ICMP报文格式一一对应。这里的 Type=8,code=0, 校验是正确，且这是一个Echo请求报文。我们再点击Responseframe:8，这里说明响应报文在序号8。详情如下： 同样的Type=8,code=0校验正确，且最下面根据请求和响应的时间戳计算出来的响应延迟。 tracerouteTraceroute是ICMP的另一个应用，用来跟踪一个分组从源点到终点的路径。traceroute是UNIX系统中的名字，在windows系统中是tracert。 traceroute发送的IP数据报封装的是无法交付的UDP用户数据报（使用了非法端口号），并由目的主机发送终点不可达差错报告报文。 源主机向目的主机发送一连串的IP数据报。第一个数据报P1的生存时间TTL设置为1，当P1到达路径上的第一个路由器R1时，R1收下它并把TTL减 1，此时TTL等于0，R1就把P1丢弃，并向源主机发送一个ICMP时间超过差错报告报文； 源主机接着发送第二个数据报P2，并把TTL设置为2。P2先到达 R1，R1收下后把TTL减 1 再转发给R2，R2收下后也把TTL减1，由于此时TTL等于0，R2就丢弃P2，并向源主机发送一个ICMP时间超过差错报文。 不断执行这样的步骤，直到最后一个数据报刚刚到达目的主机，主机不转发数据报，也不把TTL值减1。但是因为数据报封装的是无法交付的UDP，因此目的主机要向源主机发送ICMP终点不可达差错报告报文。 之后源主机知道了到达目的主机所经过的路由器IP地址以及到达每个路由器的往返时间。 UDP抓包(traceroute和tracert的不同)","link":"/2020/03/09/%E7%BD%91%E7%BB%9C%E5%B1%822/"}],"tags":[{"name":"计算机网络","slug":"计算机网络","link":"/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}],"categories":[{"name":"计算机基础","slug":"计算机基础","link":"/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"},{"name":"计算机网络","slug":"计算机基础/计算机网络","link":"/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"}]}